<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resumo do Pedido</title>
    <style>
        /* ---------------------------------------------------------------------- */
        /* ESTILOS GERAIS E FONTES - MANTIDOS */
        /* ---------------------------------------------------------------------- */
        @font-face {
            font-family: 'Basic Choice 2';
            src: url('fonts/Basic Choice 2.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        body {
            background-color: #E09F41;
            text-align: center;
            color: white;
            font-family: 'Basic Choice 2', Arial, sans-serif;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch; 
            padding-bottom: 70px; /* Espa√ßo para o rodap√© fixo */
        }
        
        .container {
            max-width: 600px;
            margin: auto;
        }
        
        img {
            width: 100%;
            height: auto;
            display: block;
            margin: 0;
        }
        
        header img:first-child { 
            width: 100%;
            height: auto;
            display: block;
            margin: 0;
        }
        
        /* ---------------------------------------------------------------------- */
        /* BARRA DE NAVEGA√á√ÉO (STICKY) - MANTIDOS */
        /* ---------------------------------------------------------------------- */
        
        #sticky-nav-container {
            background-color: #E09F41; 
            position: sticky; 
            top: 0; 
            z-index: 10; 
            width: 100%;
            padding: 5px 0; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        #categorias-horizontal {
            display: flex;
            overflow-x: scroll; 
            padding: 5px 10px;
            white-space: nowrap; 
            -webkit-overflow-scrolling: touch; 
        }

        /* Esconde a barra de rolagem horizontal */
        #categorias-horizontal::-webkit-scrollbar {
            display: none;
        }
        #categorias-horizontal {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        #categorias-horizontal a {
            display: inline-block;
            padding: 8px 15px;
            margin-right: 10px;
            background-color: #F4E6CB; 
            color: #1A2B0F; 
            text-decoration: none;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            transition: background-color 0.2s;
            flex-shrink: 0; 
            scroll-snap-align: start; 
        }

        #categorias-horizontal a:hover {
            background-color: #c9bda5;
        }
        
        /* Estilo da aba ATIVA */
        #categorias-horizontal a.active-link {
            background-color: #7FB1C8; 
            color: white;
        }

        /* ---------------------------------------------------------------------- */
        /* ESTILOS DAS TABELAS (e dos grupos para o filtro) - MANTIDOS */
        /* ---------------------------------------------------------------------- */
        .categoria-group {
            transition: opacity 0.3s ease; 
            display: none;
        }
        
        /* Sobrescreve para mostrar o grupo ATIVO */
        .categoria-group.active-group {
            display: block;
        }
        
        .categoria-group img {
            width: 50%; 
            margin: 20px auto 10px auto;
        }
        
        .categoria-group table {
            width: 100%; 
            border-collapse: collapse;
        }

        /* ESTILO PADR√ÉO DA LINHA DIVIS√ìRIA */
        .categoria-group tr { 
            border-bottom: 1px solid #F4E6CB; 
            transition: background-color 0.3s ease-in-out; 
        }

        /* CLASSE DE DESTAQUE PARA EDI√á√ÉO */
        .highlight-edit { 
            background-color: rgba(255, 255, 0, 0.4) !important; 
            transition: background-color 0.3s ease-in-out; 
        }
        
        /* Remove a borda inferior das linhas que iniciam ou continuam um grupo */
        .item-group-active {
            border-bottom: none !important;
        }
        
        /* Definindo larguras para as colunas da tabela padr√£o (com QNT. M√çN.) */
        .categoria-group:not(#grupo-cookies) th:nth-child(1), .categoria-group:not(#grupo-cookies) td:nth-child(1) { width: 45%; } 
        .categoria-group:not(#grupo-cookies) th:nth-child(2), .categoria-group:not(#grupo-cookies) td:nth-child(2) { width: 25%; } 
        .categoria-group:not(#grupo-cookies) th:nth-child(3), .categoria-group:not(#grupo-cookies) td:nth-child(3) { width: 15%; } 
        .categoria-group:not(#grupo-cookies) th:nth-child(4), .categoria-group:not(#grupo-cookies) td:nth-child(4) { width: 15%; } 

        /* AJUSTE PARA A TABELA DE COOKIES */
        #tabela-cookies th:nth-child(1), #tabela-cookies td:nth-child(1) { width: 55%; } 
        #tabela-cookies th:nth-child(2), #tabela-cookies td:nth-child(2) { width: 20%; } 
        #tabela-cookies th:nth-child(3), #tabela-cookies td:nth-child(3) { width: 25%; } 
        
        /* Ajustes finos para td/th */
        th, td { 
            padding: 10px 5px; 
            text-align: center;
            vertical-align: middle;
        }
        
        /* Alinhamento da Coluna 1 (N√ÉO agrupada) */
        .categoria-group table:not(#tabela-prato-salgado):not(#tabela-bolo-tradicional):not(#tabela-bolo-especial) td:nth-child(1) {
            text-align: left; 
            padding-left: 10px;
        }

        /* Alinhamento da Coluna 2 (QNT. MIN. ou UNID. em Cookies) */
        .categoria-group td:nth-child(2), .categoria-group td:nth-child(1):not(.item-group-cell) {
             text-align: center; 
             padding-left: 5px; 
        }
        
        caption { display: none; }
        header img + img { display: none; }

        /* Cores (AJUSTADAS) */
        table#tabela-bolo-tradicional td:nth-child(4), table#tabela-bolo-especial td:nth-child(4), table#tabela-prato-salgado td:nth-child(4), table#tabela-doces td:nth-child(4), table#tabela-cookies td:nth-child(3), table#tabela-salfri td:nth-child(4), table#tabela-salgado-forno td:nth-child(4), table#tabela-salgado-vegetariano td:nth-child(4) { color: white; }
        th:nth-child(1), th:nth-child(2), th:nth-child(3), th:nth-child(4) { color: white; }
        table#tabela-bolo-tradicional td:nth-child(1), table#tabela-bolo-especial td:nth-child(1), table#tabela-prato-salgado td:nth-child(1), table#tabela-doces td:nth-child(1), table#tabela-cookies td:nth-child(1), table#tabela-salfri td:nth-child(1), table#tabela-salgado-forno td:nth-child(1), table#tabela-salgado-vegetariano td:nth-child(1) { color: white; }


        .item-nome { font-weight: bold; color: inherit; }
        .descricao { font-size: 12px; margin-top: 4px; color: inherit; }

        .item-group-cell {
            text-align: center; 
            vertical-align: middle;
            font-size: 16px; 
            font-weight: bold;
            padding: 10px;
        }
        
        /* Estilos do Input de Quantidade na Tabela Principal */
        .quantidade-container { 
            text-align: center; 
            display: flex;
            flex-direction: column; 
            justify-content: center;
            align-items: center;
            padding: 0;
            margin: 0;
        }

        .quantidade-container input[type="number"] { 
            width: 90%; 
            height: 40px; 
            padding: 5px; 
            font-size: 16px; 
            font-family: 'Basic Choice 2', Arial, sans-serif;
            text-align: center;
            background-color: #F4E6CB; 
            border: 2px solid #F4E6CB; 
            color: #1A2B0F; 
            border-radius: 10px; 
            box-sizing: border-box;
            
            -moz-appearance: textfield; 
        }
        
        /* OCULTA√á√ÉO DE SETAS: Aplicado a ambos os inputs num√©ricos */
        .quantidade-container input[type="number"]::-webkit-outer-spin-button,
        .quantidade-container input[type="number"]::-webkit-inner-spin-button,
        .resumo-item-input-group input::-webkit-outer-spin-button, 
        .resumo-item-input-group input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        /* CORRE√á√ÉO PARA MENSAGEM DE ERRO/MINIMO PARA DOCES, SALGADOS FRITOS E FORNO */
        .erro-item-unico { 
            color: red; 
            display: none; 
            font-size: 0.9em; 
            margin-top: 5px;
            line-height: 1.1; 
            width: 100%;
            text-align: center;
        } 

        /* NOVO ESTILO: Erro de m√≠nimo na CATEGORIA (ex: Cookies) */
        .erro-categoria {
            color: red; 
            font-size: 14px; 
            margin-top: 10px; 
            font-weight: bold;
            text-align: center;
            display: none; 
            padding-bottom: 5px;
        }

        /* ---------------------------------------------------------------------- */
        /* RODAP√â FIXO (RESUMO DO PEDIDO) - MANTIDOS */
        /* ---------------------------------------------------------------------- */
        #fixed-summary {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 600px; 
            margin: auto;
            left: 0;
            right: 0;
            background-color: #F4E6CB; 
            color: #1A2B0F; 
            padding: 10px 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 50; 
            display: none; 
            box-sizing: border-box;
            text-align: left;
        }

        #fixed-summary .summary-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        #summary-text {
            line-height: 1.2;
        }

        #summary-text span {
            font-size: 12px;
            font-weight: normal;
            display: block;
            color: #555;
        }

        #summary-total {
            font-size: 20px;
            font-weight: bold;
            color: #1A2B0F;
        }
        
        /* Cor do bot√£o de rodap√© "Ver Pedido" alterada para o AZUL ESPEC√çFICO */
        #summary-button {
            background-color: #7FB1C8; 
            color: white; 
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            border: none;
            width: 150px;
            text-align: center;
            box-shadow: 0 4px #4c7e93; 
            transition: background-color 0.2s;
        }
        
        #summary-button:active {
            box-shadow: 0 2px #4c7e93;
            transform: translateY(2px);
        }
        /* ---------------------------------------------------------------------- */

        /* Estilos de Bot√µes e Popup - MANTIDOS/AJUSTADOS */
        select, input { text-align: center; }
        
        /* Input do Pop-up e Input da Tabela principal (para padronizar) */
        .popup input[type="number"] {
            background-color: #F4E6CB; 
            border: 1px solid #ccc;
            color: #1A2B0F;
            font-family: 'Basic Choice 2', Arial, sans-serif;
        }
        
        /* MODIFICA√á√ÉO AQUI: Fundo branco e fonte padronizada para inputs do resumo */
        .resumo-item-input-group input {
            background-color: white; 
            border: 1px solid #ccc;
            color: #1A2B0F;
            font-family: 'Basic Choice 2', Arial, sans-serif; 
        }

        /* Cor do bot√£o prim√°rio (Fazer Pedido/Continuar Comprando) */
        button { 
            padding: 10px; 
            border-radius: 20px; 
            background-color: #7FB1C8; 
            border: none; 
            color: #FFF; 
            cursor: pointer; 
            font-family: 'Basic Choice 2', Arial, sans-serif; 
            width: 100%; 
            font-size: 18px; 
            margin-top: 10px; 
            box-shadow: 0 4px #4c7e93; 
        }
        button:active {
            box-shadow: 0 2px #4c7e93;
            transform: translateY(2px);
        }

        /* MODIFICA√á√ÉO: Adicionando margem inferior ao bot√£o VOLTAR */
        #botao-voltar { 
            background-color: #7FB1C8; 
            color: #FFF; 
            font-size: 18px; 
            border: none; 
            padding: 12px; 
            border-radius: 20px; 
            cursor: pointer; 
            width: 100%; 
            margin-top: 20px; 
            margin-bottom: 20px; 
            font-family: 'Basic Choice 2', Arial, sans-serif; 
        }

        .erro { color: red; font-size: 14px; margin-top: 10px; }
        
        #resumo { display: none; } 
        
        /* Estilos do Popup Geral */
        .popup { 
            position: fixed; 
            z-index: 100; 
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            background-color: rgba(0, 0, 0, 0.5); 
            justify-content: center; 
            align-items: center; 
            display: none; 
        }
        
        .popup-conteudo { 
            background-color: #F4E6CB; 
            padding: 20px; 
            border-radius: 10px; 
            width: 90%; 
            max-width: 450px; 
            text-align: center; 
            position: relative; 
            max-height: 80vh; 
            overflow-y: auto; 
        }
        
        /* √çCONE DE FECHAR NO CANTO DIREITO (CORRE√á√ÉO) */
        .fechar { 
            color: #aaa; 
            font-size: 28px; 
            font-weight: bold; 
            position: absolute; 
            top: 10px; 
            right: 20px; 
            cursor: pointer; 
            z-index: 110;
        }

        /* Estilos espec√≠ficos do conte√∫do do Resumo */
        .popup-conteudo h2 { color: #1A2B0F; font-size: 26px; font-weight: bold; }
        .resumo-itens { text-align: left; padding-left: 0px; color: #1A2B0F; margin-bottom: 10px;}
        
        /* ESTILOS DE TOTAIS */
        .resumo-total { 
            text-align: right; 
            font-size: 22px; 
            font-weight: bold; 
            color: #1A2B0F; 
            margin-top: 10px;
        }
        .resumo-total-line {
            font-size: 16px; 
            font-weight: normal;
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }
        .resumo-total-line.total-com-desconto {
            color: #E60000;
        }
        /* Separador visual */
        #popup-resumo-total {
             border-top: 1px dashed #7FB1C8; 
             padding-top: 10px;
             margin-top: 10px;
        }


        /* Estilo do pre√ßo original riscado */
        .price-original-item {
            text-decoration: line-through;
            color: #888;
            font-weight: normal;
            margin-right: 5px;
        }
        
        /* Estilo do pre√ßo final com desconto */
        .price-final-item {
             color: #E60000; 
        }

        /* Estilo para cada item do resumo (linha do produto) */
        .resumo-item-line {
            display: flex;
            justify-content: space-between;
            align-items: center; 
            border-bottom: 1px dashed #7FB1C8; 
            padding: 8px 0;
            font-size: 14px;
        }
        
        /* Cont√©m o nome do item e o pre√ßo total (do item) */
        .resumo-item-name {
            flex-grow: 1;
            text-align: left;
            margin-right: 10px;
        }
        
        /* Estilo do pre√ßo no nome do item */
        .resumo-item-name small {
            display: block;
            font-weight: normal;
            color: #1A2B0F;
        }
        .resumo-item-name .price-final-item {
             color: #1A2B0F; 
             font-weight: bold;
        }

        /* Grupo de edi√ß√£o e exclus√£o no pop-up */
        .resumo-item-input-group {
            display: flex;
            align-items: center;
            flex-shrink: 0;
            gap: 5px; 
        }

        /* Estilo para o campo de input na edi√ß√£o direta (como na imagem) */
        .resumo-item-input-group input {
            width: 55px; 
            height: 35px; 
            padding: 5px;
            font-size: 14px;
            text-align: center;
            border-radius: 10px;
            box-sizing: border-box;
            margin: 0; 
            
            -moz-appearance: textfield; 
        }
        
        /* Bot√£o de excluir (Excluir) - PADRONIZADO COM APLICAR */
        .btn-excluir {
            background-color: #E60000; 
            color: white;
            width: 70px; 
            font-size: 12px; 
            padding: 10px 0; 
            margin: 0 0 0 10px; 
            border-radius: 10px; 
            box-shadow: none;
            flex-shrink: 0;
            line-height: 1; 
            height: 40px; 
        }
        
        /* ----------------- CUPOM STYLES ----------------- */
        #cupom-container {
            background-color: #e8dcc6; 
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: left;
            color: #1A2B0F;
        }

        #cupom-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            align-items: center;
        }

        #cupom-input {
            flex-grow: 1;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #7FB1C8;
            background-color: white;
            color: #1A2B0F;
            box-sizing: border-box;
            height: 40px; 
        }

        #apply-cupom-btn {
            width: 70px; 
            flex-shrink: 0;
            padding: 10px 0; 
            margin: 0;
            font-size: 14px;
            background-color: #E09F41; 
            border-radius: 10px; 
            height: 40px; 
        }

        .cupom-message {
            margin-top: 10px;
            font-size: 14px;
            font-weight: bold;
        }

        .cupom-error {
            color: red;
        }

        .cupom-success {
            color: green;
        }

        /* ---------------------------------------------------------------------- */
        /* ESTILOS DO POPUP DE INFORMA√á√ïES DO PEDIDO (Novo Estilo) */
        /* ---------------------------------------------------------------------- */
        #form-pedido {
            display: flex;
            flex-direction: column; 
            gap: 15px; 
            text-align: left;
            color: #1A2B0F; 
        }

        #form-pedido label {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: -5px; 
        }

        /* Estilo para todos os inputs e selects dentro do formul√°rio */
        #form-pedido input[type="text"],
        #form-pedido input[type="date"],
        #form-pedido input[type="time"],
        #form-pedido select {
            background-color: white; 
            color: #1A2B0F;
            border: 1px solid #7FB1C8; 
            padding: 10px;
            border-radius: 10px;
            font-family: 'Basic Choice 2', Arial, sans-serif;
            font-size: 16px;
            width: 100%; 
            box-sizing: border-box;
            text-align: left; 
        }
        
        /* Ajuste do input de nome para alinhamento esquerdo */
        #form-pedido input[type="text"] {
            text-align: left;
        }

        /* PADRONIZA√á√ÉO dos bot√µes (CONFIRMAR/EDITAR/CONTINUAR COMPRANDO) com o bot√£o azul principal */
        #form-pedido button {
            background-color: #7FB1C8; 
            box-shadow: 0 4px #4c7e93; 
            margin-top: 15px; 
        }

        /* O bot√£o "CONTINUAR COMPRANDO" (era Cancelar) mant√©m o estilo do bot√£o azul */
        #form-pedido button:nth-of-type(2) { 
            background-color: #7FB1C8;
            box-shadow: 0 4px #4c7e93;
        }
        /* ---------------------------------------------------------------------- */


        /* Media Queries (Mantidos) */
        @media (min-width: 768px) {
            header img:first-child { content: url('topodesktop.png'); }
            footer img { content: url('rodadesktop.png'); }
            #fixed-summary {
                 max-width: 600px; 
            }
        }
        @media (max-width: 767px) {
            header img:nth-of-type(2) { display: none; } 
            header img, footer img { width: 100%; }
        }
    </style>
    
</head>
<body>
    <div class="container">
        <header>
            <img src="topo.png" alt="Topo">
        </header>

        <div id="sticky-nav-container">
            <div id="categorias-horizontal">
                <a href="#grupo-bolo-tradicional" data-target="grupo-bolo-tradicional" data-img="img-bolo-tradicional">Bolos Tradicionais</a>
                <a href="#grupo-bolo-especial" data-target="grupo-bolo-especial" data-img="img-bolo-especial">Bolos Especiais</a>
                <a href="#grupo-doces" data-target="grupo-doces" data-img="img-doces">Doces</a>
                <a href="#grupo-cookies" data-target="grupo-cookies" data-img="img-cookies">Cookies</a>
                <a href="#grupo-salfri" data-target="grupo-salfri" data-img="img-salfri">Salgados Fritos</a>
                <a href="#grupo-salgado-forno" data-target="grupo-salgado-forno" data-img="img-salgado-forno">Salgados Forno</a>
                <a href="#grupo-salgado-vegetariano" data-target="grupo-salgado-vegetariano" data-img="img-salgado-vegetariano">Salgados Vegetarianos</a>
                <a href="#grupo-prato-salgado" data-target="grupo-prato-salgado" data-img="img-prato-salgado">Pratos Salgados</a>
            </div>
        </div>
        
        <div class="categoria-group active-group" id="grupo-bolo-tradicional">
            <img src="BOLTRA.png" alt="Bolos Tradicionais" id="img-bolo-tradicional"> <table id="tabela-bolo-tradicional">
                <caption>Bolos Tradicionais</caption>
                <tr>
                    <th>ITEM</th>
                    <th>tamanho</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tbody>
            </table>
        </div>

        <div class="categoria-group" id="grupo-bolo-especial">
            <img src="BOLESP.png" alt="Bolos Especiais" id="img-bolo-especial"> <table id="tabela-bolo-especial">
                <caption>Bolos Especiais</caption>
                <tr>
                    <th>ITEM</th>
                    <th>tamanho</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tbody>
            </table>
        </div>

        <div class="categoria-group" id="grupo-doces">
            <img src="DOCS.png" alt="Doces" id="img-doces"> <table id="tabela-doces">
                <caption>Doces</caption>
                <tr>
                    <th>ITEM</th>
                    <th>QNT. M√çN.</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tbody>
            </table>
        </div>

        <div class="categoria-group" id="grupo-cookies">
            <img src="cookies.png" alt="Cookies" id="img-cookies"> 
            <div id="erro-cookies" class="erro-categoria">M√≠nimo de 3 unidades na categoria Cookies.</div> 
            <table id="tabela-cookies">
                <caption>Cookies</caption>
                <tr>
                    <th>ITEM</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tb>
            </table>
        </div>

        <div class="categoria-group" id="grupo-salfri">
            <img src="salfri.png" alt="Salgados Fritos" id="img-salfri"> <table id="tabela-salfri">
                <caption>Salgados Fritos</caption>
                <tr>
                    <th>ITEM</th>
                    <th>QNT. M√çN.</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tb>
            </table>
        </div>

        <div class="categoria-group" id="grupo-salgado-forno">
            <img src="SALFOR.png" alt="Salgados Forno" id="img-salgado-forno"> <table id="tabela-salgado-forno">
                <caption>Salgados Forno</caption>
                <tr>
                    <th>ITEM</th>
                    <th>QNT. M√çN.</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tb>
            </table>
        </div>

        <div class="categoria-group" id="grupo-salgado-vegetariano">
            <img src="SALVEG.png" alt="Salgados Vegetarianos" id="img-salgado-vegetariano"> <table id="tabela-salgado-vegetariano">
                <caption>Salgados Vegetarianos</caption>
                <tr>
                    <th>ITEM</th>
                    <th>QNT. M√çN.</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tb>
            </table>
        </div>
        
        <div class="categoria-group" id="grupo-prato-salgado">
            <img src="PRASAL.png" alt="Pratos Salgados" id="img-prato-salgado"> <table id="tabela-prato-salgado">
                <caption>Pratos Salgados</caption>
                <tr>
                    <th>ITEM</th>
                    <th>tamanho</th>
                    <th>UNID.</th>
                    <th>QUANTIDADE</th>
                </tr>
                <tbody></tb>
            </table>
        </div>
        
        
        <div id="resumo" style="display:none;"> 
            <h2>Resumo do Pedido</h2>
            <div id="resumo-itens" class="resumo-itens"></div>
            <div id="resumo-total"></div>
        </div>
        
        <button id="botao-voltar" onclick="window.location.replace('https://favucozinha.github.io/Inicio/')">Voltar</button>
        
        <div id="popup-resumo" class="popup">
            <div class="popup-conteudo">
                <span class="fechar" onclick="fecharResumoPopup()">&times;</span>
                <h2>SEU PEDIDO</h2>
                
                <div id="popup-resumo-itens" class="resumo-itens"></div>
                
                <div id="cupom-container">
                    <strong>CUPOM DE DESCONTO</strong>
                    <div id="cupom-input-group">
                        <input type="text" id="cupom-input" placeholder="C√ìDIGO">
                        <button id="apply-cupom-btn" onclick="aplicarCupom()">APLICAR</button>
                    </div>
                    <div id="cupom-message" class="cupom-message"></div>
                </div>
                <div id="popup-resumo-total" class="resumo-total"></div>
                
                <div id="fazer-pedido-button-container">
                    </div>
                <button onclick="fecharResumoPopup()">CONTINUAR COMPRANDO</button>
            </div>
        </div>
        
        <div id="popup-pedido" class="popup">
            <div class="popup-conteudo">
                <span class="fechar" onclick="fecharPopup()">&times;</span>
                <h2>INFORMA√á√ïES DO PEDIDO</h2>
                <form id="form-pedido">
                    <label for="nome">NOME:</label>
                    <input type="text" id="nome" name="nome" placeholder="Seu Nome Completo" required>

                    <label for="data">DATA DA ENTREGA:</label>
                    <input type="date" id="data" name="data" required>

                    <label for="horario">HOR√ÅRIO DA ENTREGA:</label>
                    <input type="time" id="horario" name="horario" required>
                    
                    <label for="pagamento">FORMA DE PAGAMENTO:</label>
                    <select id="pagamento" name="pagamento" required>
                        <option value="Dinheiro">Dinheiro</option>
                        <option value="Cart√£o">Cart√£o</option>
                        <option value="Pix">Pix</option>
                    </select>

                    <button type="button" onclick="confirmarPedido()">CONFIRMAR PEDIDO</button>
                    <button type="button" onclick="fecharPopup()">CONTINUAR COMPRANDO</button> 
                    <button type="button" onclick="editarPedido()">EDITAR PEDIDO</button>
                </form>
            </div>
        </div>
        
        <div id="fixed-summary">
            <div class="summary-content">
                <div id="summary-text">
                    <div id="summary-total">R$ 0,00</div>
                    <span>Total sem a entrega</span>
                    <span id="summary-item-count"> / 0 itens</span>
                </div>
                <button id="summary-button" onclick="abrirResumoPopup()">Ver Pedido</button>
            </div>
        </div>

        <footer>
            <img src="roda2.png" alt="Rodap√©">
        </footer>
        
        <iframe name="hidden_iframe" id="hidden_iframe" 
                style="display:none;" 
                onload="if(window.submitted) {alert('‚úÖ Pedido Registrado! Consulte o Painel Interno.'); resetarCampos();} window.submitted=false;"></iframe>
        
        <form target="hidden_iframe" method="POST" id="form_envio_oculto" 
              action="https://docs.google.com/forms/u/1/d/e/1FAIpQLSczJtEuQDBrSdw8fr1RjCGcCvPwcLaigK-A_1BgPPK0i0k-9w/formResponse">
        </form>
        </div>

    <script>
        // üö®üö®üö® IN√çCIO DAS CONSTANTES E VARI√ÅVEIS DE CONFIGURA√á√ÉO üö®üö®üö®
        
        // 1. SEU N√öMERO DE WHATSAPP (Corrigido)
        const SEU_NUMERO_WHATSAPP = "5581997346237"; 

        // 2. URL DE ENVIO DO SEU NOVO GOOGLE FORMS (Corrigida)
        const ENDPOINT_DE_REGISTRO_FORMS = "https://docs.google.com/forms/d/e/1FAIpQLSczJtEuQDBrSdw8fr1RjCGcCvPwcLaigK-A_1BgPPK0i0k-9w/formResponse"; 

        // 3. MAPA DE CAMPOS - NOVOS ENTRY ID's DO FORMS (Mapeamento FINAL pela inspe√ß√£o)
        const FORM_MAP = {
            NOME: 'entry.461447198',              // B
            DATA: 'entry.1017281190_year',        // C (O Forms espera o ano/data principal)
            HORARIO: 'entry.928045139_hour',      // D (O Forms espera a hora principal)
            PAGAMENTO: 'entry.772122274',         // E (Mapeado com o ID da inspe√ß√£o)
            TOTAL: 'entry.106951967',             // F (Mapeado com o ID da inspe√ß√£o)
            CUPOM: 'entry.2021419276',            // G (Mapeado com o ID da inspe√ß√£o)
            RESUMO_ITENS: 'entry.857371791',      // H (Mapeado com o ID da inspe√ß√£o)
            ID_PEDIDO: 'entry.1413598671',        // I (Mapeado com o ID da inspe√ß√£o)
            STATUS: 'entry.888527842'             // J (Mapeado com o ID da inspe√ß√£o)
        };
        // üö®üö®üö® FIM DAS CONSTANTES DE CONFIGURA√á√ÉO üö®üö®üö®


        // Vari√°veis globais necess√°rias (Mantidas)
        let cupomAplicado = { codigo: null, desconto: 0, mensagem: '' };
        let totalLiquido = 0; 
        window.gruposResumo = {}; 
        window.temErroDeMinimo = false;
        window.submitted = false; // Flag para o iframe onload
        let idPedidoAtual = null; // Vari√°vel para armazenar o ID do pedido gerado

        // NOVAS CONSTANTES DE CUPOM (Mantidas)
        const CUPOM_COOKIES10 = 'COOKIES10'; 
        const CUPOM_FAVU10 = 'FAVU10OFF'; 
        const CUPOM_FAVUCOOKIES = 'FAVUCOOKIES'; 
        
        // -----------------------------------------------------
        // DADOS DOS PRODUTOS - MANTIDOS (SEM ALTERA√á√ÉO)
        // -----------------------------------------------------
        const generateId = (nome, tamanho) => {
             let base = nome.toLowerCase().replace(/[^a-z0-9]/g, '-');
             if (tamanho) {
                 base += '-' + tamanho.toLowerCase().replace(/[^a-z0-9]/g, '');
             }
             return base.replace(/-+/g, '-').trim('-');
         };
         
         const addGroupKeys = (itens) => {
             return itens.map(item => ({
                 ...item,
                 groupKey: item.tamanho ? item.nome : item.id 
             }));
         };
         
        // [C√ìDIGO DE DADOS DOS ITENS... FOI OMITIDO AQUI PARA ECONOMIZAR ESPA√áO, MAS DEVE PERMANECER NO SEU ARQUIVO ORIGINAL]
        
        const itensBoloTradicional = addGroupKeys([
            { nome: "Bolo de Bem-Casado", tamanho: "P (1.5 KG)", preco: 100.00, min: 1, descricaoResumo: "Bolo de Bem-Casado - P (1.5 KG)", descricao: ""},
            { nome: "Bolo de Bem-Casado", tamanho: "M (2.5 KG)", preco: 160.00, min: 1, descricaoResumo: "Bolo de Bem-Casado - M (2.5 KG)", descricao: ""},
            { nome: "Bolo de Bem-Casado", tamanho: "G (3.5 KG)", preco: 220.00, min: 1, descricaoResumo: "Bolo de Bem-Casado - G (3.5 KG)", descricao: ""},
            { nome: "Bolo de Doce de Leite", tamanho: "P (1.5 KG)", preco: 90.00, min: 1, descricaoResumo: "Bolo de Doce de Leite e Crocante de Amendoin - P (1.5 KG)", descricao: "Com Crocante de Amendoin"},
            { nome: "Bolo de Doce de Leite", tamanho: "M (2.5 KG)", preco: 150.00, min: 1, descricaoResumo: "Bolo de Doce de Leite e Crocante de Amendoin - M (2.5 KG)", descricao: "Com Crocante de Amendoin"},
            { nome: "Bolo de Doce de Leite", tamanho: "G (3.5 KG)", preco: 210.00, min: 1, descricaoResumo: "Bolo de Doce de Leite e Crocante de Amendoin - G (3.5 KG)", descricao: "Com Crocante de Amendoin"},
            { nome: "Bolo de Chocolate", tamanho: "P (1.5 KG)", preco: 90.00, min: 1, descricaoResumo: "Bolo de Chocolate 50% Cacau - P (1.5 KG)", descricao: "Com chocolate 50% cacau"},
            { nome: "Bolo de Chocolate", tamanho: "M (2.5 KG)", preco: 150.00, min: 1, descricaoResumo: "Bolo de Chocolate 50% Cacau - M (2.5 KG)", descricao: "Com chocolate 50% cacau"},
            { nome: "Bolo de Chocolate", tamanho: "G (3.5 KG)", preco: 210.00, min: 1, descricaoResumo: "Bolo de Chocolate 50% Cacau - G (3.5 KG)", descricao: "Com chocolate 50% cacau"},
            { nome: "Bolo de Lim√£o", tamanho: "P (1.5 KG)", preco: 90.00, min: 1, descricaoResumo: "Bolo de Lim√£o e Chocolate Branco - P (1.5 KG)", descricao: "Com Cholocate Branco"},
            { nome: "Bolo de Lim√£o", tamanho: "M (2.5 KG)", preco: 150.00, min: 1, descricaoResumo: "Bolo de Lim√£o e Chocolate Branco - M (2.5 KG)", descricao: "Com Cholocate Branco"},
            { nome: "Bolo de Lim√£o", tamanho: "G (3.5 KG)", preco: 210.00, min: 1, descricaoResumo: "Bolo de Lim√£o e Chocolate Branco - G (3.5 KG)", descricao: "Com Cholocate Branco"},
            { nome: "Bolo de Maracuj√°", tamanho: "P (1.5 KG)", preco: 90.00, min: 1, descricaoResumo: "Bolo de Maracuj√° e Chocolate Branco - P (1.5 KG)", descricao: "Com Cholocate Branco"},
            { nome: "Bolo de Maracuj√°", tamanho: "M (2.5 KG)", preco: 150.00, min: 1, descricaoResumo: "Bolo de Maracuj√° e Chocolate Branco - M (2.5 KG)", descricao: "Com Cholocate Branco"},
            { nome: "Bolo de Maracuj√°", tamanho: "G (3.5 KG)", preco: 210.00, min: 1, descricaoResumo: "Bolo de Maracuj√° e Chocolate Branco - G (3.5 KG)", descricao: "Com Cholocate Branco"},
        ]).map(item => ({...item, id: generateId(item.nome, item.tamanho)}));
        
        const itensBoloEspecial = addGroupKeys([
            { nome: "Bolo de Ameixa", tamanho: "P (1.5 KG)", preco: 110.00, min: 1, descricaoResumo: "Bolo de Ameixa e Chocolate Branco - P (1.5 KG)", descricao: "Com Chocolate Branco"},
            { nome: "Bolo de Ameixa", tamanho: "M (2.5 KG)", preco: 180.00, min: 1, descricaoResumo: "Bolo de Ameixa e Chocolate Branco - M (2.5 KG)", descricao: "Com Chocolate Branco"},
            { nome: "Bolo de Ameixa", tamanho: "G (3.5 KG)", preco: 250.00, min: 1, descricaoResumo: "Bolo de Ameixa e Chocolate Branco - G (3.5 KG)", descricao: "Com Chocolate Branco"},
            { nome: "Bolo de Caf√© e Doce de Leite", tamanho: "P (1.5 KG)", preco: 110.00, min: 1, descricaoResumo: "Bolo de Caf√© Com Doce de Leite e Chocolate Amargo - P (1.5 KG)", descricao:"Com Chocolate Amargo"},
            { nome: "Bolo de Caf√© e Doce de Leite", tamanho: "M (2.5 KG)", preco: 180.00, min: 1, descricaoResumo: "Bolo de Caf√© Com Doce de Leite e Chocolate Amargo - M (2.5 KG)", descricao:"Com Chocolate Amargo"},
            { nome: "Bolo de Caf√© e Doce de Leite", tamanho: "G (3.5 KG)", preco: 250.00, min: 1, descricaoResumo: "Bolo de Caf√© Com Doce de Leite e Chocolate Amargo - G (3.5 KG)", descricao:"Com Chocolate Amargo"},
            { nome: "Bolo de Chocolate 50%", tamanho: "P (1.5 KG)", preco: 110.00, min: 1, descricaoResumo: "Bolo de Chocolate 50% com Morangos - P (1.5 KG)", descricao:"Com Morangos"},
            { nome: "Bolo de Chocolate 50%", tamanho: "M (2.5 KG)", preco: 175.00, min: 1, descricaoResumo: "Bolo de Chocolate 50% com Morangos - M (2.5 KG)", descricao:"Com Morangos"},
            { nome: "Bolo de Chocolate 50%", tamanho: "G (3.5 KG)", preco: 245.00, min: 1, descricaoResumo: "Bolo de Chocolate 50% com Morangos - G (3.5 KG)", descricao:"Com Morangos"},
            { nome: "Bolo de Delicia de Abacaxi", tamanho: "P (1.5 KG)", preco: 105.00, min: 1, descricaoResumo: "Bolo de Delicia de Abacaxi - P (1.5 KG)", descricao: ""},
            { nome: "Bolo de Delicia de Abacaxi", tamanho: "M (2.5 KG)", preco: 175.00, min: 1, descricaoResumo: "Bolo de Delicia de Abacaxi - M (2.5 KG)", descricao: ""},
            { nome: "Bolo de Delicia de Abacaxi", tamanho: "G (3.5 KG)", preco: 245.00, min: 1, descricaoResumo: "Bolo de Delicia de Abacaxi - G (3.5 KG)", descricao: ""},
            { nome: "Bolo de Morango", tamanho: "P (1.5 KG)", preco: 110.00, min: 1, descricaoResumo: "Bolo de Morango com Brigadeiro Branco e Chantinhinho - P (1.5 KG)", descricao: "Com Recheio de Brigadeiro Branco e Cobertura de Chantininho"},
            { nome: "Bolo de Morango", tamanho: "M (2.5 KG)", preco: 175.00, min: 1, descricaoResumo: "Bolo de Morango com Brigadeiro Branco e Chantinhinho - M (2.5 KG)", descricao: "Com Recheio de Brigadeiro Branco e Cobertura de Chantininho"},
            { nome: "Bolo de Morango", tamanho: "G (3.5 KG)", preco: 245.00, min: 1, descricaoResumo: "Bolo de Morango com Brigadeiro Branco e Chantinhinho - G (3.5 KG)", descricao: "Com Recheio de Brigadeiro Branco e Cobertura de Chantininho"},
            { nome: "Bolo de Ninho trufado", tamanho: "P (1.5 KG)", preco: 110.00, min: 1, descricaoResumo: "Bolo de Ninho trufado - P (1.5 KG)", descricao: "Com chocolate Branco"},
            { nome: "Bolo de Ninho trufado", tamanho: "M (2.5 KG)", preco: 175.00, min: 1, descricaoResumo: "Bolo de Ninho trufado - M (2.5 KG)", descricao: "Com chocolate Branco"},
            { nome: "Bolo de Ninho trufado", tamanho: "G (3.5 KG)", preco: 245.00, min: 1, descricaoResumo: "Bolo de Ninho trufado - G (3.5 KG)", descricao: "Com chocolate Branco"},
            { nome: "Bolo Prest√≠gio", tamanho: "P (1.5 KG)", preco: 105.00, min: 1, descricaoResumo: "Bolo Prest√≠gio - P (1.5 KG)", descricao: ""},
            { nome: "Bolo Prest√≠gio", tamanho: "M (2.5 KG)", preco: 175.00, min: 1, descricaoResumo: "Bolo Prest√≠gio - M (2.5 KG)", descricao: ""},
            { nome: "Bolo Prest√≠gio", tamanho: "G (3.5 KG)", preco: 245.00, min: 1, descricaoResumo: "Bolo Prest√≠gio - G (3.5 KG)", descricao: ""},     
            { nome: "Bolo Red velvet", tamanho: "P (1.5 KG)", preco: 105.00, min: 1, descricaoResumo: "Bolo Red velvet - P (1.5 KG)", descricao: ""},
            { nome: "Bolo Red velvet", tamanho: "M (2.5 KG)", preco: 175.00, min: 1, descricaoResumo: "Bolo Red velvet - M (2.5 KG)", descricao: ""},
            { nome: "Bolo Red velvet", tamanho: "G (3.5 KG)", preco: 245.00, min: 1, descricaoResumo: "Bolo Red Velvet - G (3.5 KG)", descricao: ""},
        ]).map(item => ({...item, id: generateId(item.nome, item.tamanho)}));

        const itensDoces = addGroupKeys([
            { nome: "Beijinho", min: 20, preco: 1.20, descricaoResumo: "Beijinho", descricao: "" },
            { nome: "Bem-casado", min: 20, preco: 1.20, descricaoResumo: "Bem-casado", descricao: "" },
            { nome: "Brigadeiro", min: 20, preco: 1.20, descricaoResumo: "Brigadeiro", descricao: "" },
            { nome: "Mini Tortilete", min: 20, preco: 1.30, descricaoResumo: "Mini Tortilete", descricao: "" },
            { nome: "Moranguinho", min: 20, preco: 1.20, descricaoResumo: "Moranguinho", descricao: "" },
            { nome: "Ouri√ßo", min: 20, preco: 1.30, descricaoResumo: "Ouri√ßo", descricao: "" },
            { nome: "Queijadinha", min: 20, preco: 1.30, descricaoResumo: "Queijadinha", descricao: "" },
            { nome: "Surpresa de uva", min: 20, preco: 1.30, descricaoResumo: "Surpresa de uva", descricao: "" },
        ]).map(item => ({...item, id: generateId(item.nome)}));

        const itensCookies = addGroupKeys([
            { nome: "Cookie Tradicional", min: 1, preco: 12.00, descricaoResumo: "Cookie Tradicional", descricao: "Massa de baunilha com peda√ßos de chocolate meio amargo" },
            { nome: "Cookie Red Velvet", min: 1, preco: 12.00, descricaoResumo: "Cookie Red Velvet", descricao: "Massa de baunilha com toque de cream cheese, cacau vermelho e peda√ßos de chocolate branco" },
            { nome: "Cookie Black", min: 1, preco: 12.00, descricaoResumo: "Cookie Black", descricao: "Massa feita com cacau 100% e peda√ßos de chocolate meio amargo" },
            { nome: "Cookie Romeu e Julieta", min: 1, preco: 12.00, descricaoResumo: "Cookie Romeu e Julieta", descricao: "Massa de baunilha com pedacinhos de queijo, recheado com cream cheese e goiabada" },
        ]).map(item => ({...item, id: generateId(item.nome)}));

        const itensSalgadoFrito = addGroupKeys([
            { nome: "Bolinho de Bacalhau", min: 20, preco: 1.30, descricaoResumo: "Bolinho de Bacalhau", descricao: "" },
            { nome: "Bolinho de Calabresa", min: 20, preco: 1.00, descricaoResumo: "Bolinho de Calabresa", descricao: "" },
            { nome: "Bolinho de Charque", min: 20, preco: 1.20, descricaoResumo: "Bolinho de Charque", descricao: "" },
            { nome: "Coxinha de Frango", min: 20, preco: 1.00, descricaoResumo: "Coxinha de Frango", descricao: "" },
            { nome: "Croquete Misto", min: 20, preco: 1.00, descricaoResumo: "Croquere Misto", descricao: "De Presunto Com Queijo" },
            { nome: "Camar√£o Empanado", min: 20, preco: 1.50, descricaoResumo: "Camar√£o Empanado", descricao: "" },
            { nome: "Mini Quibe", min: 20, preco: 1.10, descricaoResumo: "Mini Quibe de Carne C/ Queijo", descricao: "De Carne Com Queijo" },
            { nome: "Pastel de Festa", min: 20, preco: 1.30, descricaoResumo: "Pastel de Festa", descricao: "" },
        ]).map(item => ({...item, id: generateId(item.nome)}));

        const itensSalgadoForno = addGroupKeys([
            { nome: "Canudinho de Frango", min: 20, preco: 1.50, descricaoResumo: "Canudinho de Frango", descricao: "Massa Caseira Assada no Forno" },
            { nome: "Empadinha de Bacalhau", min: 20, preco: 1.30, descricaoResumo: "Empadinha de Bacalhau", descricao: "" },
            { nome: "Empadinha de Camar√£o", min: 20, preco: 1.30, descricaoResumo: "Empadinha de Camar√£o", descricao: "" },
            { nome: "Empadinha de Carne", min: 20, preco: 1.00, descricaoResumo: "Empadinha de Carne", descricao: "" },
            { nome: "Empadinha de Frango", min: 20, preco: 1.00, descricaoResumo: "Empadinha de Frango", descricao: "" },
            { nome: "Mini Folhado de Carne", min: 20, preco: 2.20, descricaoResumo: "Mini Folhado de Carne", descricao: "" },
            { nome: "Mini Folhado de Frango", min: 20, preco: 2.20, descricaoResumo: "Mini Folhado de Frango", descricao: "" },
            { nome: "Mini Folhado de Queijo", min: 20, preco: 2.20, descricaoResumo: "Mini Folhado de Queijo", descricao: "" },
            { nome: "Mini Folhado de Pizza", min: 20, preco: 2.20, descricaoResumo: "Mini Folhado de Pizza", descricao: "" },
            { nome: "Mini Enroladinho", min: 20, preco: 1.00, descricaoResumo: "Mini Enroladinho de salsicha", descricao: "Com Salsicha" },
            { nome: "Pastel de Forno de Bacalhau", min: 20, preco: 1.30, descricaoResumo: "Pastel de Forno de Bacalhau", descricao: "" },
            { nome: "Pastel de Forno de Camar√£o", min: 20, preco: 1.40, descricaoResumo: "Pastel de Forno de Camar√£o", descricao: "" },
            { nome: "Pastel de Forno de Carne", min: 20, preco: 1.00, descricaoResumo: "Pastel de Forno de Carne", descricao: "" },
            { nome: "Pastel de Forno de Frango", min: 20, preco: 1.00, descricaoResumo: "Pastel de Forno de Frango", descricao: "" },
            { nome: "Pastel de Forno de Queijo", min: 20, preco: 1.00, descricaoResumo: "Pastel de Forno de Queijo", descricao: "" },
            { nome: "Pastel de Forno de Pizza", min: 20, preco: 1.00, descricaoResumo: "Pastel de Forno de Pizza", descricao: "" },
        ]).map(item => ({...item, id: generateId(item.nome)}));
        
        const itensSalgadoVegetariano = addGroupKeys([
            { nome: "Canudinho de Soja", min: 20, preco: 1.50, descricaoResumo: "Canudinho de Soja", descricao: "Massa Caseira Assada no Forno" },
            { nome: "Coxinha de Soja", min: 20, preco: 1.00, descricaoResumo: "Coxinha de SOJA", descricao: "" },
            { nome: "Coxinha de Caju *", min: 20, preco: 1.20, descricaoResumo: "Coxinha de CAJU", descricao: "* CONSULTAR DISPONIBILIDADE *" },
            { nome: "Empadinha de Creme de Aborbinha", min: 20, preco: 1.00, descricaoResumo: "Empadinha de Aborbinha Com Queijo", descricao: "Com Queijo" },
            { nome: "Empadinha de Falso Camar√£o", min: 20, preco: 1.00, descricaoResumo: "Empadinha de Falso Camar√£o", descricao: "A Base de Milho e Leite de Coco" },
            { nome: "Pastel de Festa Vegetariano", min: 20, preco: 1.30, descricaoResumo: "Pastel de Festa de SOJA", descricao: "De Soja" },
            { nome: "Pastel de Forno Creme de Abobrinha", min: 20, preco: 1.00, descricaoResumo: "Pastel de Forno Abobrinha C/ Queijo", descricao: "Com Queijo" },
            { nome: "Pastel de Forno Caju *", min: 20, preco: 1.30, descricaoResumo: "Pastel de Forno Caju", descricao: "* CONSULTAR DISPONIBILIDADE *" },
        ]).map(item => ({...item, id: generateId(item.nome)}));

        const itensPratoSalgado = addGroupKeys([
            { nome: "Empad√£o de Bacalhau", tamanho: "P (1 KG)", preco: 120.00, min: 1, descricaoResumo: "Empad√£o de Bacalhau - P (1 KG)", descricao: ""},
            { nome: "Empad√£o de Bacalhau", tamanho: "M (2 KG)", preco: 220.00, min: 1, descricaoResumo: "Empad√£o de Bacalhau - M (2 KG)", descricao: ""},
            { nome: "Empad√£o de Bacalhau", tamanho: "G (3 KG)", preco: 340.00, min: 1, descricaoResumo: "Empad√£o de Bacalhau - G (3 KG)", descricao: ""},
            { nome: "Empad√£o de Carne", tamanho: "P (1 KG)", preco: 70.00, min: 1, descricaoResumo: "Empad√£o de Carne - P (1 KG)", descricao: ""},
            { nome: "Empad√£o de Carne", tamanho: "M (2 KG)", preco: 140.00, min: 1, descricaoResumo: "Empad√£o de Carne - M (2 KG)", descricao: ""},
            { nome: "Empad√£o de Carne", tamanho: "G (3 KG)", preco: 210.00, min: 1, descricaoResumo: "Empad√£o de Carne - G (3 KG)", descricao: ""},
            { nome: "Empad√£o de Camar√£o", tamanho: "P (1 KG)", preco: 120.00, min: 1, descricaoResumo: "Empad√£o de Camar√£o - P (1 KG)", descricao: ""},
            { nome: "Empad√£o de Camar√£o", tamanho: "M (2 KG)", preco: 220.00, min: 1, descricaoResumo: "Empad√£o de Camar√£o - M (2 KG)", descricao: ""},
            { nome: "Empad√£o de Camar√£o", tamanho: "G (3 KG)", preco: 340.00, min: 1, descricaoResumo: "Empad√£o de Camar√£o - G (3 KG)", descricao: ""},
            { nome: "Empad√£o de Frango", tamanho: "P (1 KG)", preco: 70.00, min: 1, descricaoResumo: "Empad√£o de Frango - P (1 KG)", descricao: ""},
            { nome: "Empad√£o de Frango", tamanho: "M (2 KG)", preco: 140.00, min: 1, descricaoResumo: "Empad√£o de Frango - M (2 KG)", descricao: ""},
            { nome: "Empad√£o de Frango", tamanho: "G (3 KG)", preco: 210.00, min: 1, descricaoResumo: "Empad√£o de Frango - G (3 KG)", descricao: ""},
            { nome: "Fricass√™ de Frango", tamanho: "P (1 KG)", preco: 80.00, min: 1, descricaoResumo: "Fricass√™ de Frango - P (1 KG)", descricao: ""},
            { nome: "Fricass√™ de Frango", tamanho: "M (2 KG)", preco: 160.00, min: 1, descricaoResumo: "Fricass√™ de Frango - M (2 KG)", descricao: ""},
            { nome: "Fricass√™ de Frango", tamanho: "G (3 KG)", preco: 240.00, min: 1, descricaoResumo: "Fricass√™ de Frango - G (3 KG)", descricao: ""},
            { nome: "Quiche de Camar√£o", tamanho: "P (1 KG)", preco: 120.00, min: 1, descricaoResumo: "Quiche de Camar√£o - P (1 KG)", descricao: ""},
            { nome: "Quiche de Camar√£o", tamanho: "M (2 KG)", preco: 240.00, min: 1, descricaoResumo: "Quiche de Camar√£o - M (2 KG)", descricao: ""},
            { nome: "Quiche de Camar√£o", tamanho: "G (3 KG)", preco: 360.00, min: 1, descricaoResumo: "Quiche de Camar√£o - G (3 KG)", descricao: ""},
            { nome: "Quiche de Frango", tamanho: "P (1 KG)", preco: 90.00, min: 1, descricaoResumo: "Quiche de Frango - P (1 KG)", descricao: "Com Alho Por√≥"},
            { nome: "Quiche de Frango", tamanho: "M (2 KG)", preco: 180.00, min: 1, descricaoResumo: "Quiche de Frango - M (2 KG)", descricao: "Com Alho Por√≥"},
            { nome: "Quiche de Frango", tamanho: "G (3 KG)", preco: 260.00, min: 1, descricaoResumo: "Quiche de Frango - G (3 KG)", descricao: "Com Alho Por√≥"},
            { nome: "Rocambole de Bacalhau", tamanho: "P (1 KG)", preco: 120.00, min: 1, descricaoResumo: "Rocambole de Bacalhau - P (1 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Bacalhau", tamanho: "M (2 KG)", preco: 240.00, min: 1, descricaoResumo: "Rocambole de Bacalhau - M (2 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Bacalhau", tamanho: "G (3 KG)", preco: 360.00, min: 1, descricaoResumo: "Rocambole de Bacalhau - G (3 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Camar√£o", tamanho: "P (1 KG)", preco: 120.00, min: 1, descricaoResumo: "Rocambole de Camar√£o - P (1 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Camar√£o", tamanho: "M (2 KG)", preco: 240.00, min: 1, descricaoResumo: "Rocambole de Camar√£o - M (2 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Camar√£o", tamanho: "G (3 KG)", preco: 365.00, min: 1, descricaoResumo: "Rocambole de Camar√£o - G (3 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Carne", tamanho: "P (1 KG)", preco: 70.00, min: 1, descricaoResumo: "Rocambole de Carne - P (1 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Carne", tamanho: "M (2 KG)", preco: 140.00, min: 1, descricaoResumo: "Rocambole de Carne - M (2 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Carne", tamanho: "G (3 KG)", preco: 210.00, min: 1, descricaoResumo: "Rocambole de Carne - G (3 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Frango", tamanho: "P (1 KG)", preco: 70.00, min: 1, descricaoResumo: "Rocambole de Frango - P (1.5 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Frango", tamanho: "M (2 KG)", preco: 140.00, min: 1, descricaoResumo: "Rocambole de Frango - M (2 KG)", descricao: "Massa de Batata"},
            { nome: "Rocambole de Frango", tamanho: "G (3 KG)", preco: 210.00, min: 1, descricaoResumo: "Rocambole de Frango - G (3 KG)", descricao: "Massa de Batata"},
            { nome: "Torta Salgada de Bacalhau", tamanho: "P (1 KG)", preco: 120.00, min: 1, descricaoResumo: "Torta Salgada de Bacalhau - P (1 KG)", descricao: ""},
            { nome: "Torta Salgada de Bacalhau", tamanho: "M (2 KG)", preco: 240.00, min: 1, descricaoResumo: "Torta Salgada de Bacalhau - M (2 KG)", descricao: ""},
            { nome: "Torta Salgada de Bacalhau", tamanho: "G (3 KG)", preco: 360.00, min: 1, descricaoResumo: "Torta Salgada de Bacalhau - G (3 KG)", descricao: ""},
            { nome: "Torta Salgada de Carne", tamanho: "P (1 KG)", preco: 70.00, min: 1, descricaoResumo: "Torta Salgada de Carne - P (1 KG)", descricao: ""},
            { nome: "Torta Salgada de Carne", tamanho: "M (2 KG)", preco: 140.00, min: 1, descricaoResumo: "Torta Salgada de Carne - M (2 KG)", descricao: ""},
            { nome: "Torta Salgada de Carne", tamanho: "G (3 KG)", preco: 210.00, min: 1, descricaoResumo: "Torta Salgada de Carne - G (3 KG)", descricao: ""},
            { nome: "Torta Salgada de Camar√£o", tamanho: "P (1 KG)", preco: 120.00, min: 1, descricaoResumo: "Torta Salgada de Camar√£o - P (1 KG)", descricao: ""},
            { nome: "Torta Salgada de Camar√£o", tamanho: "M (2 KG)", preco: 240.00, min: 1, descricaoResumo: "Torta Salgada de Camar√£o - M (2 KG)", descricao: ""},
            { nome: "Torta Salgada de Camar√£o", tamanho: "G (3 KG)", preco: 360.00, min: 1, descricaoResumo: "Torta Salgada de Camar√£o - G (3 KG)", descricao: ""},
            { nome: "Torta Salgada de Frango", tamanho: "P (1 KG)", preco: 70.00, min: 1, descricaoResumo: "Torta Salgada de Frango - P (1 KG)", descricao: ""},
            { nome: "Torta Salgada de Frango", tamanho: "M (2 KG)", preco: 140.00, min: 1, descricaoResumo: "Torta Salgada de Frango - M (2 KG)", descricao: ""},
            { nome: "Torta Salgada de Frango", tamanho: "G (3 KG)", preco: 210.00, min: 1, descricaoResumo: "Torta Salgada de Frango - G (3 KG)", descricao: ""},
        ]).map(item => ({...item, id: generateId(item.nome, item.tamanho)}));
         
        const gruposItens = {
             "tabela-bolo-tradicional": { itens: itensBoloTradicional, nomeGrupo: "Bolos Tradicionais", img: "img-bolo-tradicional", minTotal: 0 },
             "tabela-bolo-especial": { itens: itensBoloEspecial, nomeGrupo: "Bolos Especiais", img: "img-bolo-especial", minTotal: 0 },
             "tabela-doces": { itens: itensDoces, nomeGrupo: "Doces", img: "img-doces", minTotal: 0 },
             "tabela-cookies": { itens: itensCookies, nomeGrupo: "Cookies", img: "img-cookies", minTotal: 3, minIndividual: 1 }, 
             "tabela-salfri": { itens: itensSalgadoFrito, nomeGrupo: "Salgados Fritos", img: "img-salfri", minTotal: 0 },
             "tabela-salgado-forno": { itens: itensSalgadoForno, nomeGrupo: "Salgados Assados", img: "img-salgado-forno", minTotal: 0 },
             "tabela-salgado-vegetariano": { itens: itensSalgadoVegetariano, nomeGrupo: "Salgados Vegetarianos", img: "img-salgado-vegetariano", minTotal: 0 },
             "tabela-prato-salgado": { itens: itensPratoSalgado, nomeGrupo: "Pratos Salgados", img: "img-prato-salgado", minTotal: 0 },
         };
         
         let todosOsItens = [];
         for (const idTabela in gruposItens) {
             gruposItens[idTabela].itens.forEach(item => {
                 todosOsItens.push({
                     nome: item.descricaoResumo,
                     id: item.id, 
                     grupoId: "grupo-" + idTabela.replace("tabela-", "")
                 });
             });
         }
        
        // -----------------------------------------------------
        // FUN√á√ïES DE CRIA√á√ÉO, FILTRO E EDI√á√ÉO (MANTIDAS)
        // -----------------------------------------------------
        function criarTabelaGrupo(grupo, idTabela, nomeGrupo) {
             const tbody = document.getElementById(idTabela).querySelector('tbody');
             if (!tbody) return;
        
             let grupoAtual = null;
             let countGrupo = 0;
             
             const isGroupedTable = idTabela.includes('bolo') || idTabela.includes('prato');
             const isCookieTable = idTabela === 'tabela-cookies';
             const minDoGrupo = gruposItens[idTabela]?.minTotal || 0;
        
        
             for (let i = 0; i < grupo.length; i++) {
                 const item = grupo[i];
                 const tr = document.createElement("tr");
                 
                 const coluna2 = isCookieTable ? item.preco.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : (item.tamanho || item.min); 
                 const precoFormatado = item.preco.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                 const itemId = item.id;
                 
                 tr.id = itemId; 
                 
                 let isFirstInGroup = false;
                 
                 if (isGroupedTable) {
                     if (item.groupKey !== grupoAtual) {
                         grupoAtual = item.groupKey;
                         isFirstInGroup = true;
                         countGrupo = 1;
                         let j = i + 1;
                         while (j < grupo.length && grupo[j].groupKey === grupoAtual) {
                             countGrupo++;
                             j++;
                         }
                     }
                     
                     if (item.groupKey === grupoAtual && i < grupo.length - 1 && grupo[i+1].groupKey === grupoAtual) {
                                         tr.classList.add('item-group-active');
                     }
                 }
                 
                 const inputHtml = `<input type="number" value="0" data-min="${item.min || 1}" data-preco="${item.preco}" data-resumo="${item.descricaoResumo}" data-grupo="${nomeGrupo}" data-item-id="${itemId}" class="quantidade-input">`;
        
                 let erroHtml = '';
                 const gruposComMinimoIndividual = ["Doces", "Salgados Fritos", "Salgados Assados", "Salgados Vegetarianos"];
                 const isIndividualMinCheck = gruposComMinimoIndividual.includes(nomeGrupo) && (item.min && item.min > 1);
                 
                 if (isIndividualMinCheck) {
                     erroHtml = `<div class="erro-item-unico">M√≠n ${item.min} Unid.</div>`; 
                 }
        
        
                 let celulasComuns;
        
                 if (isCookieTable) {
                     celulasComuns = `
                         <td>
                             <div class="item-nome">${item.nome}</div>
                             ${item.descricao ? `<div class="descricao">${item.descricao}</div>` : ''}
                         </td>
                         <td>R$ ${precoFormatado}</td>
                         <td>
                             <div class="quantidade-container">
                                 ${inputHtml}
                                 ${erroHtml}
                             </div>
                         </td>
                     `;
                 } else {
                     celulasComuns = `
                         <td>
                             <div class="item-nome">${item.nome}</div>
                             ${item.descricao ? `<div class="descricao">${item.descricao}</div>` : ''}
                         </td>
                         <td>${coluna2}</td>
                         <td>R$ ${precoFormatado}</td>
                         <td>
                             <div class="quantidade-container">
                                 ${inputHtml}
                                 ${erroHtml}
                             </div>
                         </td>
                     `;
                 }
        
                 const celulasAgrupadas = `
                     <td>${coluna2}</td>
                     <td>R$ ${precoFormatado}</td>
                     <td>
                         <div class="quantidade-container">
                             ${inputHtml}
                             ${erroHtml}
                         </div>
                     </td>
                 `;
        
                 if (isGroupedTable && isFirstInGroup) {
                     tr.innerHTML = `
                         <td rowspan="${countGrupo}" class="item-group-cell">
                             <div class="item-nome">${item.nome}</div>
                             ${item.descricao ? `<div class="descricao">${item.descricao}</div>` : ''}
                         </td>
                         ${celulasAgrupadas}
                     `;
                 } else if (isGroupedTable && !isFirstInGroup) {
                     tr.innerHTML = celulasAgrupadas;
                 } else {
                     tr.innerHTML = celulasComuns;
                 }
                 
                 tbody.appendChild(tr);
             }
         }
        
         function ativarAba(linkElement) {
             const targetGroupId = linkElement.getAttribute('data-target');
             const targetGroup = document.getElementById(targetGroupId);
             const categoriasBar = document.getElementById('categorias-horizontal');
        
             if (!targetGroup) return;
        
             categoriasBar.querySelectorAll('a').forEach(link => {
                 link.classList.remove('active-link');
             });
             document.querySelectorAll('.categoria-group').forEach(group => {
                 group.classList.remove('active-group');
             });
        
             linkElement.classList.add('active-link');
             targetGroup.classList.add('active-group');
             
             linkElement.scrollIntoView({ behavior: 'smooth', inline: 'center' }); 
         }
        
         function scrollToElement(targetElement) {
             if (!targetElement) return;
             document.querySelectorAll('.highlight-edit').forEach(el => {
                 el.classList.remove('highlight-edit');
             });
             const mainHeader = document.querySelector('header');
             const stickyNav = document.getElementById('sticky-nav-container');
             const fixedHeight = (mainHeader ? mainHeader.offsetHeight : 0) + (stickyNav ? stickyNav.offsetHeight : 0) + 10;
             const elementPosition = targetElement.getBoundingClientRect().top + window.scrollY;
             const offsetPosition = elementPosition - fixedHeight;
        
             window.scrollTo({
                 top: Math.max(0, offsetPosition), 
                 behavior: 'smooth'
             });
         }
         
         function limparCupom() {
             cupomAplicado = { codigo: null, desconto: 0, mensagem: '' };
             const cupomInput = document.getElementById('cupom-input');
             if (cupomInput) cupomInput.value = '';
         }
        
         function aplicarCupom() {
             const cupomInput = document.getElementById('cupom-input');
             const cupomCode = cupomInput.value.toUpperCase().trim();
             const cupomMessage = document.getElementById('cupom-message');
             
             cupomAplicado = { codigo: null, desconto: 0, mensagem: '' };
             cupomMessage.className = 'cupom-message'; 
             
             let totalBrutoPedido = 0; 
             let totalCookies = 0;
             let subtotalCookies = 0; 
             const cookiesGrupos = ["Cookies"]; 
             let hasCookieItem = false;
             
             const gruposComMinimoIndividual = ["Doces", "Salgados Fritos", "Salgados Assados", "Salgados Vegetarianos"];
             let temErroDeMinimoLocal = false; 
        
             document.querySelectorAll(".quantidade-input").forEach(input => {
                 const grupo = input.getAttribute("data-grupo");
                 const quantidade = parseInt(input.value) || 0; 
                 const preco = parseFloat(input.getAttribute("data-preco")) || 0;
                 const min = parseInt(input.getAttribute("data-min")) || 1;
                 
                 const isIndividualMinCheck = gruposComMinimoIndividual.includes(grupo) && min > 1;
                 const isItemValido = quantidade >= min;
                 
                 if (quantidade > 0 && isIndividualMinCheck && !isItemValido) {
                     temErroDeMinimoLocal = true;
                 }
        
                 if (quantidade > 0 && (!isIndividualMinCheck || isItemValido)) {
                     const totalItem = quantidade * preco;
                     totalBrutoPedido += totalItem; 
                 }
        
                 if (cookiesGrupos.includes(grupo)) {
                     totalCookies += quantidade;
                     subtotalCookies += quantidade * preco;
                     if (quantidade > 0) {
                         hasCookieItem = true;
                     }
                 }
             });
        
             const minTotalCookies = gruposItens["tabela-cookies"]?.minTotal || 0;
             const cookiesValidos = totalCookies === 0 || totalCookies >= minTotalCookies;
             if (!cookiesValidos && totalCookies > 0) temErroDeMinimoLocal = true;
             
             if (temErroDeMinimoLocal) {
                 cupomAplicado.mensagem = 'Ajuste as quantidades m√≠nimas do seu pedido antes de aplicar um cupom.';
                 cupomMessage.classList.add('cupom-error');
                 atualizarTotal();
                 return;
             }
        
             const taxaDesconto = 0.10; 
             const minCookiesCupom = 4; 
        
             if (cupomCode === CUPOM_FAVU10) {
                 if (totalBrutoPedido === 0) {
                     cupomAplicado.mensagem = 'Adicione itens ao carrinho antes de aplicar o cupom.';
                     cupomMessage.classList.add('cupom-error');
                     atualizarTotal();
                     return;
                 }
                 const descontoTotal = totalBrutoPedido * taxaDesconto;
                 cupomAplicado = {
                     codigo: cupomCode,
                     desconto: descontoTotal, 
                     mensagem: `CUPOM ${cupomCode} APLICADO! (10% OFF no total)` 
                 };
                 cupomMessage.classList.add('cupom-success');
                 
             } else if (cupomCode === CUPOM_COOKIES10) {
                 if (!hasCookieItem) {
                     cupomAplicado.mensagem = 'Cupom v√°lido apenas para Cookies.';
                     cupomMessage.classList.add('cupom-error');
                     atualizarTotal();
                     return;
                 }
                 if (totalCookies < minCookiesCupom) {
                     cupomAplicado.mensagem = `CUPOM V√ÅLIDO APENAS PARA NO M√çNIMO ${minCookiesCupom} COOKIES.`;
                     cupomMessage.classList.add('cupom-error');
                     atualizarTotal();
                     return;
                 }
                 const descontoTotal = subtotalCookies * taxaDesconto; 
                 cupomAplicado = {
                     codigo: cupomCode,
                     desconto: descontoTotal, 
                     mensagem: `CUPOM ${cupomCode} APLICADO! (10% OFF em Cookies)` 
                 };
                 cupomMessage.classList.add('cupom-success');
                 
             } else if (cupomCode === CUPOM_FAVUCOOKIES) {
                 if (!hasCookieItem) {
                     cupomAplicado.mensagem = 'Cupom v√°lido apenas para Cookies.';
                     cupomMessage.classList.add('cupom-error');
                     atualizarTotal();
                     return;
                 }
                 const dataAtual = new Date();
                 const diaDaSemana = dataAtual.getDay(); 
        
                 if (diaDaSemana === 0 || diaDaSemana === 5 || diaDaSemana === 6) { 
                     cupomAplicado.mensagem = 'Cupom v√°lido apenas para pedidos realizados entre Segunda e Quinta-feira.';
                     cupomMessage.classList.add('cupom-error');
                     atualizarTotal();
                     return;
                 }
        
                 if (totalCookies < minCookiesCupom) {
                     cupomAplicado.mensagem = `CUPOM V√ÅLIDO APENAS PARA NO M√çNIMO ${minCookiesCupom} COOKIES.`;
                     cupomMessage.classList.add('cupom-error');
                     atualizarTotal();
                     return;
                 }
                 const descontoTotal = subtotalCookies * taxaDesconto; 
                 cupomAplicado = {
                     codigo: cupomCode,
                     desconto: descontoTotal, 
                     mensagem: `CUPOM ${cupomCode} APLICADO! (10% OFF)` 
                 };
                 cupomMessage.classList.add('cupom-success');
                 
             } else if (cupomCode) {
                 cupomAplicado.mensagem = `C√≥digo "${cupomCode}" inv√°lido.`;
                 cupomMessage.classList.add('cupom-error');
             }
             
             cupomMessage.textContent = cupomAplicado.mensagem;
             atualizarTotal();
         }
         
         function excluirItem(itemId) {
             const inputNoMain = document.querySelector(`.quantidade-input[data-item-id="${itemId}"]`);
             if (inputNoMain) {
                 inputNoMain.value = "0"; 
                 inputNoMain.dispatchEvent(new Event('input')); 
             }
             if (cupomAplicado.codigo) aplicarCupom();
             
             if (parseFloat(document.getElementById("summary-total").textContent.replace('R$ ', '').replace('.', '').replace(',', '.')) > 0) {
                 abrirResumoPopup();
             } else {
                 fecharResumoPopup();
             }
         }
         
         function atualizarQuantidadeDireta(inputElement) {
             const itemId = inputElement.getAttribute('data-item-id');
             const valorInput = inputElement.value.replace(/[^0-9]/g, ''); 
             let novaQuantidade = parseInt(valorInput) || 0;
        
             const inputNoMain = document.querySelector(`.quantidade-input[data-item-id="${itemId}"]`);
        
             if (inputNoMain) {
                 if (novaQuantidade <= 0) {
                     novaQuantidade = 0; 
                     inputElement.value = "0"; 
                 } else {
                     inputElement.value = novaQuantidade; 
                 }
        
                 inputNoMain.value = novaQuantidade;
                 
                 atualizarTotal();
                 
                 if (cupomAplicado.codigo) aplicarCupom();
        
                 if (parseFloat(document.getElementById("summary-total").textContent.replace('R$ ', '').replace('.', '').replace(',', '.')) > 0) {
                     abrirResumoPopup(); 
                 } else {
                     fecharResumoPopup();
                 }
             }
         }
         
         function atualizarTotal() {
             let totalBruto = 0;
             let totalItens = 0;
             const resumoItensPopup = document.getElementById("popup-resumo-itens");
             const resumoTotalPopup = document.getElementById("popup-resumo-total");
             const fixedSummary = document.getElementById("fixed-summary");
             const fazerPedidoContainer = document.getElementById("fazer-pedido-button-container");
             
             if (!resumoItensPopup || !fixedSummary || !fazerPedidoContainer) return;
             resumoItensPopup.innerHTML = ''; 
        
             const gruposResumoParaEnvio = {}; 
             const totaisPorGrupo = {};
        
             const gruposComMinimoIndividual = ["Doces", "Salgados Fritos", "Salgados Assados", "Salgados Vegetarianos"];
        
             document.querySelectorAll(".quantidade-input").forEach(input => {
                 const quantidade = parseInt(input.value) || 0;
                 const min = parseInt(input.getAttribute("data-min")) || 1;
                 const preco = parseFloat(input.getAttribute("data-preco")) || 0;
                 const descricaoResumo = input.getAttribute("data-resumo");
                 const grupo = input.getAttribute("data-grupo");
                 const itemId = input.getAttribute("data-item-id");
                 
                 const erroElemento = input.closest('.quantidade-container').querySelector('.erro-item-unico');
                 
                 const isIndividualMinCheck = gruposComMinimoIndividual.includes(grupo) && min > 1; 
        
                 if (!totaisPorGrupo[grupo]) {
                     totaisPorGrupo[grupo] = { quantidade: 0, items: [] };
                 }
                 totaisPorGrupo[grupo].quantidade += quantidade;
                 totaisPorGrupo[grupo].items.push({ input, quantidade, min, preco, descricaoResumo, itemId, grupo });
        
                 const isItemInError = isIndividualMinCheck && quantidade > 0 && quantidade < min;
                 
                 if (isItemInError) {
                     if (erroElemento) {
                         erroElemento.textContent = `M√≠n ${min} Unid.`;
                         erroElemento.style.display = 'block';
                     }
                 } else {
                     if (erroElemento) erroElemento.style.display = 'none'; 
                 }
             });
        
             window.temErroDeMinimo = false;
             
             for (const grupo in totaisPorGrupo) {
                 const infoGrupo = totaisPorGrupo[grupo];
                 const idTabela = `tabela-${grupo.toLowerCase().replace(/\s/g, '-')}`;
                 const minTotal = gruposItens[idTabela]?.minTotal || 0;
                 const isCookieGroup = grupo === "Cookies";
                 const erroCategoriaElemento = isCookieGroup ? document.getElementById('erro-cookies') : null;
                 
                 let grupoValido = true;
                 
                 if (minTotal > 0 && infoGrupo.quantidade > 0 && infoGrupo.quantidade < minTotal) {
                     grupoValido = false;
                     window.temErroDeMinimo = true;
                     if (erroCategoriaElemento) {
                         erroCategoriaElemento.textContent = `M√≠nimo de ${minTotal} unidades na categoria ${grupo}.`;
                         erroCategoriaElemento.style.display = 'block';
                     }
                 } else {
                     if (erroCategoriaElemento) erroCategoriaElemento.style.display = 'none';
                 }
        
                 infoGrupo.items.forEach(item => {
                     const isIndividualMinCheck = gruposComMinimoIndividual.includes(grupo) && item.min > 1;
                     const isItemValido = item.quantidade >= item.min;
                     
                     if (item.quantidade > 0) {
                         let shouldIncludeInTotal = true;
                         
                         if (isIndividualMinCheck && !isItemValido) {
                              shouldIncludeInTotal = false;
                              window.temErroDeMinimo = true; 
                         }
                         if (minTotal > 0 && !grupoValido) {
                              shouldIncludeInTotal = false; 
                         }
                         
                         if (shouldIncludeInTotal) {
                             const totalItem = item.quantidade * item.preco;
                             totalBruto += totalItem;
                             totalItens += item.quantidade;
                         }
        
                         if (!gruposResumoParaEnvio[grupo]) gruposResumoParaEnvio[grupo] = [];
                         gruposResumoParaEnvio[grupo].push({ 
                             descricaoResumo: item.descricaoResumo, 
                             quantidade: item.quantidade 
                         });
                     }
                 });
             }
        
             const descontoTotal = cupomAplicado.desconto;
             window.totalLiquido = totalBruto; 
             
             if (descontoTotal > 0) {
                 window.totalLiquido = totalBruto - descontoTotal;
             }
        
             const totalBrutoFormatado = totalBruto.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
             const totalLiquidoFormatado = window.totalLiquido.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
             
             resumoItensPopup.innerHTML = '';
             for (const grupo in gruposResumoParaEnvio) {
                 resumoItensPopup.innerHTML += `<strong>${grupo}:</strong><br>`;
                 gruposResumoParaEnvio[grupo].forEach(item => {
                     const itemOriginal = todosOsItens.find(i => i.nome === item.descricaoResumo);
                     const preco = itemOriginal ? gruposItens[itemOriginal.grupoId.replace('grupo-', 'tabela-')].itens.find(i => i.descricaoResumo === item.descricaoResumo)?.preco || 0 : 0;
                     const precoTotalItem = item.quantidade * preco;
                     let precoExibicao = `R$ ${precoTotalItem.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                     
                     resumoItensPopup.innerHTML += `
                         <div class="resumo-item-line">
                             <div class="resumo-item-name">
                                 ${item.descricaoResumo} 
                                 <small>${precoExibicao}</small>
                             </div>
                             <div class="resumo-item-input-group">
                                 <input type="number" 
                                          min="0" 
                                          value="${item.quantidade}" 
                                          data-item-id="${itemOriginal?.id}" 
                                          onblur="atualizarQuantidadeDireta(this)">
                                 un.
                             </div>
                             <div class="resumo-item-actions">
                                 <button class="btn-excluir" onclick="excluirItem('${itemOriginal?.id}')">EXCLUIR</button>
                             </div>
                         </div>
                     `;
                 });
             }
        
             if (descontoTotal > 0) {
                  resumoTotalPopup.innerHTML = `
                       <div class="resumo-total-line">SUBTOTAL: R$ ${totalBrutoFormatado}</div>
                       <div class="resumo-total-line total-com-desconto">DESCONTO CUPOM: R$ ${descontoTotal.toFixed(2).replace('.', ',')}</div>
                       <div class="resumo-total">TOTAL: R$ ${totalLiquidoFormatado}</div>
                       `;
             } else {
                  resumoTotalPopup.textContent = `TOTAL: R$ ${totalBrutoFormatado}`;
                  const cupomMessage = document.getElementById('cupom-message');
                  if (totalBruto === 0 && cupomMessage) {
                      cupomMessage.textContent = '';
                      cupomAplicado = { codigo: null, desconto: 0, mensagem: '' };
                      }
             }
        
             if (totalBruto > 0 && !window.temErroDeMinimo) {
                  fazerPedidoContainer.innerHTML = '<button onclick="abrirPopup()">FAZER PEDIDO</button>';
             } else {
                  fazerPedidoContainer.innerHTML = '';
             }
             
             if (totalBruto > 0) {
                 document.getElementById("summary-total").textContent = `R$ ${totalLiquidoFormatado}`;
                 document.getElementById("summary-item-count").textContent = ` / ${totalItens} ${totalItens === 1 ? 'item' : 'itens'}`;
                 fixedSummary.style.display = 'block';
             } else {
                 document.getElementById("summary-total").textContent = `R$ 0,00`;
                 document.getElementById("summary-item-count").textContent = ` / 0 itens`;
                 fixedSummary.style.display = 'none';
                 fecharResumoPopup();
             }
             
             window.gruposResumo = gruposResumoParaEnvio;
         }
        
        // -----------------------------------------------------
        // FUN√á√ïES POPUP - MANTIDAS
        // -----------------------------------------------------
        function abrirResumoPopup() {
             const cupomMessage = document.getElementById('cupom-message');
             cupomMessage.className = 'cupom-message';
             cupomMessage.textContent = cupomAplicado.mensagem;
             
             const totalText = document.getElementById("summary-total").textContent;
             const total = parseFloat(totalText.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0; 
             
             if (total > 0) {
                  document.getElementById("popup-resumo").style.display = "flex";
             } else {
                  alert("Seu pedido est√° vazio. Adicione itens para visualizar o resumo!");
             }
         }
         
         function fecharResumoPopup() {
             document.getElementById("popup-resumo").style.display = "none";
         }
        
         function abrirPopup() {
             fecharResumoPopup(); 
             document.getElementById("popup-pedido").style.display = "flex";
         }
         
         function fecharPopup() {
             document.getElementById("popup-pedido").style.display = "none";
         }
        
         function editarPedido() {
             fecharPopup(); 
             abrirResumoPopup(); 
         }
         
         function resetarCampos() {
             document.querySelectorAll(".quantidade-input").forEach(input => {
                 input.value = "0"; 
                 const erroElemento = input.closest('.quantidade-container').querySelector('.erro-item-unico');
                 if (erroElemento) erroElemento.style.display = 'none';
             });
             
             document.querySelectorAll('.erro-categoria').forEach(el => el.style.display = 'none');
             
             const resumoItens = document.getElementById("popup-resumo-itens");
             const resumoTotal = document.getElementById("popup-resumo-total");
             if (resumoItens) resumoItens.innerHTML = '';
             if (resumoTotal) resumoTotal.textContent = '';
             
             limparCupom();
        
             fecharPopup();
             fecharResumoPopup();
             atualizarTotal();
             window.scrollTo(0, 0);
         }

        // NOVO: GERA ID √öNICO
        function gerarIdPedido() {
            // Exemplo: PEDIDO-20251023-181512-321
            const agora = new Date();
            const dataStr = agora.toLocaleDateString('sv-SE').replace(/-/g, '');
            const horaStr = agora.toLocaleTimeString('pt-BR', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit'}).replace(/:/g, '');
            const random = Math.floor(Math.random() * 900) + 100; // N√∫mero de 3 d√≠gitos
            return `PEDIDO-${dataStr}-${horaStr}-${random}`;
        }
        
        // NOVO: Fun√ß√£o para ENVIAR WHATSAPP (para o seu n√∫mero)
        function enviarWhatsapp(nome, data, horario, pagamento, total, resumo, idPedido, cupom) {
             let mensagem = `*‚úÖ NOVO PEDIDO - ID: ${idPedido}*\n\n`;
             mensagem += `*Cliente:* ${nome}\n`;
             mensagem += `*Total:* R$ ${total}\n`;
             mensagem += `*Cupom:* ${cupom}\n\n`;
             mensagem += `*AGENDA*\n`;
             mensagem += `Data: ${data}\n`;
             mensagem += `Hor√°rio: ${horario}\n`;
             mensagem += `Pagamento: ${pagamento}\n\n`;
             mensagem += `*ITENS:*\n${resumo.trim()}\n\n`;
             mensagem += `*Status Inicial:* Aberto\n\n`;
             mensagem += `_Este pedido foi registrado em seu painel interno._`;

             // O link do whatsapp j√° usa o n√∫mero configurado na constante SEU_NUMERO_WHATSAPP
             const url = `https://wa.me/${SEU_NUMERO_WHATSAPP}?text=${encodeURIComponent(mensagem)}`;
             
             // Abre o WhatsApp em uma nova aba/janela para que o cliente envie
             window.open(url, '_blank');
        }

        // FUN√á√ÉO PRINCIPAL CONFIRMAR PEDIDO (FINAL)
        function confirmarPedido() {
            
            atualizarTotal(); 

            // Valida√ß√£o de Preenchimento do Formul√°rio
            const nome = document.getElementById("nome").value;
            const data = document.getElementById("data").value;
            const horario = document.getElementById("horario").value;
            const pagamento = document.getElementById("pagamento").value;
            
            const totalExibido = parseFloat(document.getElementById("summary-total").textContent.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0; 

            // 1. MONTA A MENSAGEM DE ERRO DETALHADA
            let mensagemErro = "N√£o foi poss√≠vel confirmar o pedido. Por favor, corrija:\n\n";
            let hasError = false;

            if (totalExibido <= 0) {
                mensagemErro += "‚Ä¢ O pedido est√° vazio. Adicione pelo menos um item v√°lido.\n";
                hasError = true;
            }
            // Verifica se h√° erro de m√≠nimo individual ou de grupo (Cookies)
            if (window.temErroDeMinimo) {
                mensagemErro += "‚Ä¢ Corrija as quantidades m√≠nimas de alguns produtos (ex: Doces, Cookies). Verifique no bot√£o 'Ver Pedido'.\n";
                hasError = true;
            }
            if (!nome) {
                mensagemErro += "‚Ä¢ O campo NOME est√° vazio.\n";
                hasError = true;
            }
            if (!data) {
                mensagemErro += "‚Ä¢ O campo DATA DA ENTREGA est√° vazio.\n";
                hasError = true;
            }
            if (!horario) {
                mensagemErro += "‚Ä¢ O campo HOR√ÅRIO DA ENTREGA est√° vazio.\n";
                hasError = true;
            }
            
            // 2. EXIBE O ERRO E PARA O ENVIO
            if (hasError) {
                alert(mensagemErro.trim());
                return; // Para o envio do formul√°rio
            }

            // -----------------------------------------------------------------
            // 3. ENVIO EST√Å OK - GERA√á√ÉO E ENVIO DE DADOS
            // -----------------------------------------------------------------

            // GERA O ID √öNICO E ARMAZENA
            idPedidoAtual = gerarIdPedido(); 

            const cupom = cupomAplicado.codigo || "Nenhum";
            
            // CORRE√á√ÉO: Formata√ß√£o para PONTO (Ex: 150.00) para o Forms reconhecer como n√∫mero.
            const totalForms = totalLiquido.toFixed(2); 
            
            // Formato com v√≠rgula para o WhatsApp (exibi√ß√£o)
            const totalWhatsApp = totalLiquido.toFixed(2).replace('.', ','); 
            
            // Monta a string de resumo
            let resumoString = '';
            for (const grupo in window.gruposResumo) {
                resumoString += `[${grupo}]: `;
                window.gruposResumo[grupo].forEach(item => {
                    resumoString += `${item.descricaoResumo} (${item.quantidade} un); `;
                });
            }
            
            // PREPARA√á√ÉO DO FORMUL√ÅRIO OCULTO (Registro no Google Sheets)
            const form = document.getElementById('form_envio_oculto');
            form.innerHTML = ''; // Limpa campos anteriores

            // Adiciona os campos de input escondidos com os entry.IDs
            const campos = {
                [FORM_MAP.NOME]: nome,
                [FORM_MAP.DATA]: data,
                [FORM_MAP.HORARIO]: horario,
                [FORM_MAP.PAGAMENTO]: pagamento,
                [FORM_MAP.TOTAL]: totalForms, // ENVIANDO COM PONTO
                [FORM_MAP.CUPOM]: cupom,
                [FORM_MAP.RESUMO_ITENS]: resumoString.trim(),
                [FORM_MAP.ID_PEDIDO]: idPedidoAtual, 
                [FORM_MAP.STATUS]: 'Aberto' 
            };

            for (const entryId in campos) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = entryId;
                input.value = campos[entryId];
                form.appendChild(input);
            }
            
            // ENVIO PARA O GOOGLE FORMS (REGISTRO NO SHEETS)
            window.submitted = true;
            form.submit(); 

            // CHAMA O ENVIO DO WHATSAPP (usa o total formatado com V√çRGULA)
            enviarWhatsapp(nome, data, horario, pagamento, totalWhatsApp, resumoString.trim(), idPedidoAtual, cupom);

            // Fechamos o popup do pedido (o alerta de sucesso ser√° dado pelo iframe.onload)
            fecharPopup();
        }
        // -----------------------------------------------------
        
        
        document.addEventListener("DOMContentLoaded", function () {
            
            for (const idTabela in gruposItens) {
                const tabelaId = idTabela;
                criarTabelaGrupo(gruposItens[idTabela].itens, tabelaId, gruposItens[idTabela].nomeGrupo);
            }

            const gruposComMinimoIndividual = ["Doces", "Salgados Fritos", "Salgados Assados", "Salgados Vegetarianos"];

            document.querySelectorAll(".quantidade-input").forEach(input => {
                input.addEventListener("input", atualizarTotal);
                
                input.addEventListener("blur", function() {
                    const quantidade = parseInt(this.value) || 0;
                    
                    if (this.value === "" || quantidade <= 0) {
                        this.value = "0"; 
                    } else {
                        this.value = quantidade.toString();
                    }

                    atualizarTotal();
                });
            });
            
            const categoriasBar = document.getElementById('categorias-horizontal');
            const links = categoriasBar.querySelectorAll('a');
            
            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    ativarAba(this);
                    
                    const targetImageId = this.getAttribute('data-img');
                    const targetElement = document.getElementById(targetImageId);

                    if (targetElement) {
                        scrollToElement(targetElement);
                    }
                });
            });

            const primeiroLink = document.querySelector('#categorias-horizontal a[data-target="grupo-bolo-tradicional"]');
            const primeiroGrupo = document.getElementById('grupo-bolo-tradicional');
            
            if (primeiroLink) {
                primeiroLink.classList.add('active-link');
            }
            if (primeiroGrupo) {
                primeiroGrupo.classList.add('active-group');
            }
            
            document.addEventListener('click', function(event) {
                const popupResumo = document.getElementById('popup-resumo');
                const popupPedido = document.getElementById('popup-pedido');
                
                if (popupResumo && popupResumo.style.display === 'flex' && event.target === popupResumo) {
                    fecharResumoPopup();
                }
                
                if (popupPedido && popupPedido.style.display === 'flex' && event.target === popupPedido) {
                    fecharPopup();
                }
            });


            const confirmarPedidoButton = document.querySelector('button[onclick="confirmarPedido()"]');
            if (confirmarPedidoButton) {
                confirmarPedidoButton.addEventListener("click", confirmarPedido);
            }

            atualizarTotal();
        });
    </script>
    
</body>
</html>
